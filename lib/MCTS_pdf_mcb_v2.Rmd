---
output: pdf_document
params: 
    set_title: "My Title!"
---


---
title: `r id`
---


| Type       | Your Average                     | Total Average                          |
|------------|----------------------------------|----------------------------------------|
| CALORIES   | `r round(mean(submap$KCAL),2)` | `r round(mean(map$KCAL,na.rm=TRUE),2)` |
| PROTEIN    | `r round(mean(submap$PROT),2)` | `r round(mean(map$PROT,na.rm=TRUE),2)` |
| TOTAL FAT  | `r round(mean(submap$TFAT),2)` | `r round(mean(map$TFAT,na.rm=TRUE),2)` |
| CARBS      | `r round(mean(submap$CARB),2)` | `r round(mean(map$CARB,na.rm=TRUE),2)` |
| FIBER      | `r round(mean(submap$FIBE),2)` | `r round(mean(map$FIBE,na.rm=TRUE),2)` |



##MicroNutrients

```{r, echo=FALSE}
dfm <- melt(submap[,c('StudyDayNo','PROT','TFAT','FIBE','CAFF','FIBE','SUGR')],id.vars = 1)
ggplot(dfm,aes(x = StudyDayNo,y = value)) + 
    geom_bar(aes(fill = variable),stat = "identity",position = "stack") + scale_x_discrete(labels = abbreviate) +
  theme_classic()
```

##Daily Calorie Intake
```{r, echo=FALSE}

p <- ggplot(submap,aes(x = StudyDayNo,y = KCAL)) + 
     geom_bar(aes(fill = StudyDayNo),stat = "identity",position = "dodge") + scale_x_discrete(labels = abbreviate)
p+guides(fill=FALSE) +
  theme_classic()
```

##Microbiome Daily Relative Abundance
```{r, echo-FALSE}
# make ggplot bar chart of top 10 most abundant species per day
#melt subtaxasp to get our dataframe in the long format for future usage
  meltdf<- melt(subtaxasp)
  
  #merge to get access to Day var
  mergedf<- merge(x=meltdf, y=map, by.x = "variable", by.y= "X.SampleID", all.x=TRUE)
  
  #convert our dataframe species (rn) column to a character
  mergedf$rn <- as.character(mergedf$rn) 
  
  #series of gsub commands meant to neaten and clarify legend content
  mergedf$rn <- gsub(".*s__", "", mergedf$rn)
  mergedf$rn <- gsub("\\[", "",mergedf$rn)
  mergedf$rn <- gsub("\\]", "",mergedf$rn)
  mergedf$rn <- gsub("_", " ",mergedf$rn)
  
  
  #create <10% abundance category
  mergedf$rn[mergedf$value < 0.1] <- "<10% abundance"
  

ggplot(mergedf, aes(x = StudyDayNo, y = value, fill = rn)) +
  geom_bar(stat = "identity") +
  scale_x_discrete(drop = FALSE) +
  theme_classic() +
  theme(strip.text.y = element_text(angle = 0, size = 8, face = "italic"),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.title.x = element_blank(),
        plot.title = element_text(hjust = 0.5),
        strip.background = element_rect(color = "grey")) +
  guides(fill = guide_legend(reverse = TRUE, 
                             keywidth = 1, 
                             keyheight = 1, 
                             ncol = 1)) +
  ylab("Relative Abundance\n") +
  ggtitle("Main species within your gut per day")





```


```{r, echo=FALSE}
 #transpose
   subtaxaalpha <- t(subtaxaalpha)
 
  #calculate alpha diversity and assign to variable alphad
   alphad <- diversity(subtaxaalpha, index = "shannon", MARGIN = 1, base = exp(1))
   alphad <- as.data.frame(alphad)
   alphad <- rownames_to_column(alphad, var = "X.SampleID")
   
   #merge melted df with map to get access to StudyDay variable
   merged_alpha<- merge(x=alphad, y=map, all.x=TRUE)

#make gg plot line graph of subject alpha diversity per day
ggplot(merged_alpha, aes(x=StudyDayNo, y=alphad, group = UserName)) +
  geom_point() +
  geom_smooth() +
  theme_classic()
```

```{r, echo=FALSE}
#create PCOA plot of beta diversities of pertinent subjects
# 
# ggplot(PCOA) +
#   geom_point(aes(x=PC1,y=PC2, col=UserName, shape=UserName, size=4)) + #gives axes and item of focus
#   labs(title="PCOA plot") +
#   scale_shape_manual(values=shape_pal3) +
#   theme_classic()
```

